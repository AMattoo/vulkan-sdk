<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Vulkan SDK for Android 1.1.1: Adaptive Scalable Texture Compression (ASTC) with ARM Mali</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function()
{ (i[r].q=i[r].q||[]).push(arguments)}
,i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-35797182-1', 'auto');
ga('send', 'pageview');
</script>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="top_banner.bmp"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Vulkan SDK for Android 1.1.1
<span id="malidevcenter"><a href="http://malideveloper.arm.com">Mali Developer Center</a></span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_a_s_t_c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Adaptive Scalable Texture Compression (ASTC) with ARM Mali </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Introduces how to use the ASTC compression standard for textures in Vulkan.</p>
<div class="image">
<img src="astc.png" alt="astc.png"/>
<div class="caption">
ASTC compressed at various bit-rates</div></div>
 <dl class="section note"><dt>Note</dt><dd>This sample will only run as intended on GPUs which support ASTC. For other GPUs, a fallback PNG will be displayed instead.</dd></dl>
<h1><a class="anchor" id="ASTCIntroduction"></a>
Introduction</h1>
<p>ASTC is a texture compression standard which currently represents the state of the art in GPU texture compression. "Adaptive" and "Scalable" refer to important features:</p>
<ul>
<li>Supports both LDR/HDR textures, although only LDR textures are part of core Vulkan.</li>
<li>Supports both 2D and 3D textures, although only 2D textures are part of core Vulkan.</li>
<li>Support for any number of color channels and uncorrelated channels for special purpose texture data.</li>
<li>Supports a wide range of quality settings ranging from 8bpp all the way down to less than 1bpp for 2D images in fine grained steps.</li>
<li>In LDR mode, UNORM and SRGB are supported.</li>
</ul>
<p>For more information specifically about ASTC, please visit: <a href="https://developer.arm.com/technologies/graphics-technologies/adaptive-scalable-texture-compression">ASTC Overview</a></p>
<p>Texture compression is vital in order to reduce the size of games and other applications which rely heavily on textures. An other aspect of texture compression is reducing bandwidth on the GPU which can improve performance and significantly reduce power consumption.</p>
<p>For this sample we will demonstrate LDR ASTC at different quality settings from highest quality (4x4 blocks) down to lowest (12x12 blocks).</p>
<h1><a class="anchor" id="ASTCEncoding"></a>
Encoding images to ASTC</h1>
<p>ASTC is an open standard and anyone can freely implement tools which decode and encode ASTC. For this sample, we will use the reference ASTC compressor from ARM which can be found on <a href="https://github.com/ARM-software/astc-encoder">GitHub</a>.</p>
<div class="fragment"><div class="line"><span class="comment">// Compresses PNG to ASTC header + payload, 4x4 blocks, thorough mode.</span></div><div class="line">astcenc -c texture.png texture.astc 4x4 -thorough</div></div><!-- fragment --><p>The ASTC payload format generated by astcenc consists of a 16 byte header, followed by the raw ASTC blocks.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>ASTCHeader</div><div class="line">{</div><div class="line">        uint8_t magic[4];</div><div class="line">        uint8_t blockdimX;</div><div class="line">        uint8_t blockdimY;</div><div class="line">        uint8_t blockdimZ;</div><div class="line">        uint8_t xsize[3];</div><div class="line">        uint8_t ysize[3];</div><div class="line">        uint8_t zsize[3];</div><div class="line">};</div><div class="line">static_assert(<span class="keyword">sizeof</span>(ASTCHeader) == 16, <span class="stringliteral">&quot;Packed ASTC header struct is not 16 bytes.&quot;</span>);</div><div class="line"></div><div class="line"><span class="preprocessor">#define ASTC_MAGIC 0x5CA1AB13</span></div></div><!-- fragment --><h1><a class="anchor" id="ASTCDetection"></a>
Detecting ASTC support</h1>
<p>ASTC is a core feature in Vulkan, but supporting the format is optional. To detect if ASTC is supported on your GPU, you can use</p>
<div class="fragment"><div class="line"><span class="comment">// Check if the device supports ASTC textures.</span></div><div class="line">VkFormatProperties properties;</div><div class="line">vkGetPhysicalDeviceFormatProperties(pContext-&gt;getPhysicalDevice(), VK_FORMAT_ASTC_4x4_UNORM_BLOCK, &amp;properties);</div><div class="line"><span class="keywordtype">bool</span> supportsASTC = (properties.optimalTilingFeatures &amp; VK_FORMAT_FEATURE_SAMPLED_IMAGE_BIT) != 0;</div></div><!-- fragment --><h1><a class="anchor" id="ASTCUpload"></a>
Uploading ASTC textures to GPU</h1>
<p>Uploading ASTC textures is no different from uploading other images. Just like in the <a class="el" href="rotating_texture.html">Rotating Texture</a> sample we will use vkCmdCopyBufferToImage to copy our ASTC payload into the texture.</p>
<p>To load the image, we'll use the convenience function</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (supportsASTC)</div><div class="line">{</div><div class="line">        LOGI(<span class="stringliteral">&quot;Device supports ASTC, loading ASTC texture!\n&quot;</span>);</div><div class="line">        <span class="keywordflow">if</span> (FAILED(loadASTCTextureFromAsset(pPath, &amp;buffer, &amp;width, &amp;height, &amp;format)))</div><div class="line">        {</div><div class="line">                LOGE(<span class="stringliteral">&quot;Failed to load texture from asset.\n&quot;</span>);</div><div class="line">                abort();</div><div class="line">        }</div><div class="line">}</div></div><!-- fragment --><p>If ASTC is not supported, we just load the fallback PNG texture.</p>
<dl class="section note"><dt>Note</dt><dd>For PNG input images, astcenc Y-flips the input texture, so we do the same for the fallback PNG texture. The vertex shader this time around applies the Y flip to get back to non-flipped input.</dd></dl>
<p>The only real difference between uploading compressed textures and uncompressed textures is that ASTC textures use a different format, VK_FORMAT_ASTC_*. The entry points for creating textures and uploading them are the same.</p>
<div class="fragment"><div class="line">VkBufferImageCopy region = {};</div><div class="line">region.bufferOffset = 0;</div><div class="line">region.bufferRowLength = 0; <span class="comment">// Tightly packed.</span></div><div class="line">region.imageSubresource.aspectMask = VK_IMAGE_ASPECT_COLOR_BIT;</div><div class="line">region.imageSubresource.layerCount = 1;</div><div class="line">region.imageExtent.width = width;</div><div class="line">region.imageExtent.height = height;</div><div class="line">region.imageExtent.depth = 1;</div><div class="line"></div><div class="line"><span class="comment">// Copy the buffer to our optimally tiled image. No difference between ASTC and uncompressed textures.</span></div><div class="line">vkCmdCopyBufferToImage(cmd, stagingBuffer.buffer, image, VK_IMAGE_LAYOUT_TRANSFER_DST_OPTIMAL, 1, &amp;region);</div></div><!-- fragment --><h1><a class="anchor" id="ASTCLinks"></a>
Links</h1>
<p><a href="https://developer.arm.com/technologies/graphics-technologies/adaptive-scalable-texture-compression">ASTC Overview</a></p>
<p><a href="https://github.com/ARM-software/astc-encoder">ASTC Encoder - Github</a> </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="tutorials.html">Tutorials</a></li>
    <li class="footer">
        <a class="copyright" href="http://www.arm.com/">(C) ARM Ltd. 2016</a>
    </li>
  </ul>
</div>
</body>
</html>
